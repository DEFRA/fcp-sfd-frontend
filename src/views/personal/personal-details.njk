{% extends 'common/layout.njk' %}

{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
{% from "common/navigation/back-sign-out-link.njk" import appBackSignOutLink with context %}

{% block beforeContent %}
  {{ appBackSignOutLink(backLink) }}
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
      {# Notification banner #}
      {% if notification %}
        {{ govukNotificationBanner({
          type: "success",
          titleText: notification.title,
          text: notification.text
        }) }}
      {% endif %}

    <span class="govuk-caption-l text-wrap-no-hyphen">{{userName}}</span>

    <h1 class="govuk-heading-l">
      View and update your personal details
    </h1>

    {% set formattedAddress %}
      {% for addressLine in address %}
        <div>{{addressLine}}</div>
      {% endfor %}
    {% endset %}

    {% set displayPersonalTelephone %}
      <div>Telephone: <span class="govuk-hint display-inline">{{personalTelephone.telephone}}</span></div>
      <div>Mobile: <span class="govuk-hint display-inline">{{personalTelephone.mobile}}</span></div>
    {% endset %}

    {% set displayDOB %}
      {% if dateOfBirth.dob === 'Not added' %}
        <div><span class="govuk-hint display-inline">{{dateOfBirth.dob}}</span></div>
      {% else %}
        <div>{{dateOfBirth.dob}}</div>
      {% endif %}
    {% endset %}

    {{ govukSummaryList({
      rows: [
        {
          key: {
            text: "Full name"
          },
          value: {
            text: fullName
          },
          actions: {
            items: [
              {
                href: "/account-name-change",
                text: "Change",
                visuallyHiddenText: "Full name"
              }
            ]
          }
        },
        {
          key: {
            text: "Date of birth"
          },
          value: {
            html: displayDOB
          },
          actions: {
            items: [
              {
                href: dateOfBirth.link,
                text: dateOfBirth.action,
                visuallyHiddenText: "date of birth"
              }
            ]
          }
        },
        {
          key: {
            text: "Customer reference number"
          },
          value: {
            text: crn
          }
        },
        {
          key: {
            text: "Personal address"
          },
          value: {
            html: formattedAddress
          },
          actions: {
            items: [
              {
                href: "/account-address-change",
                text: "Change",
                visuallyHiddenText: "personal address"
              }
            ]
          }
        },
        {
          key: {
            text: "Personal phone numbers"
          },
          value: {
            html: displayPersonalTelephone
          },
          actions: {
            items: [
              {
                href: personalTelephone.link,
                text: personalTelephone.action,
                visuallyHiddenText: "personal phone numbers"
              }
            ]
          }
        },
        {
          key: {
            text: "Personal email address"
          },
          value: {
            text: personalEmail.email
          },
          actions: {
            items: [
              {
                href: personalEmail.link,
                text: personalEmail.action,
                visuallyHiddenText: "personal email address"
              }
            ]
          }
        }
      ]
    }) }}

  </div>
</div>
{% endblock %}
